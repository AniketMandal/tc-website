machine:
  java:
    version: openjdk7
  services:
    - docker

checkout:
  pre:
    - pwd
    - git clone --branch dev-circleci https://github.com/topcoder-platform/tc-website-glue glue
    - git clone https://github.com/topcoder-platform/tc-website-shared shared
    - git clone https://github.com/topcoder-platform/tc-website-external-artifacts external-artifacts
    - git clone https://github.com/appirio-tech/tc-cache tc-cache
    - ls -a

compile:
  override:
    - ant -version
    - which ant
    - ant -f move.xml package-topcoder
    - zip -r lib.zip lib
    - zip -r resources.zip resources
    - cd ../tc-cache && ant && cp build/dist/lib/tcs/tc_cache/1.0.0/tc_cache.jar ../tc-website/ && cd ../tc-website
    
test:
  override:
    - pwd && ls 
    #- cp -Rf .deploy/circleci/* . && docker run -v ${HOME}:/root/tc-platform appiriodevops/tc-website:build

deployment:
  development:
    branch: [dev, dev-circleci]
    commands:
      - ./buildimage.sh DEV
      - ./deploy.sh DEV $CIRCLE_SHA1
  qa:
    branch: qa
    commands:
      - ./buildimage.sh QA    
      - ./deploy.sh QA $CIRCLE_SHA1
  production:
    branch: master
    commands:
      - ./buildimage.sh PROD    
      - ./deploy.sh PROD $CIRCLE_SHA1
